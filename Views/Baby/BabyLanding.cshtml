@using Baby_Tracker.Models
@using System.Collections.Generic 


@{
    Layout = "_BabyLayout";
}

@{
    // Calculate age in days. Will expand to show age differently depending on age bracket.
    TimeSpan days = DateTime.Now.Subtract(Model.BirthDateTime);
    int days_num = ((int)days.TotalMinutes)/1440;

    // 
    string dateToday = DateTime.Now.Day.ToString();
    int monthToday = DateTime.Now.Month;
    string monthNameToday = null;

    switch (monthToday)
        {
            case 1:
                monthNameToday = "January";
                break;
            case 2:
                monthNameToday = "February";
                break;
            case 3:
                monthNameToday = "March";
                break;
            case 4:
                monthNameToday = "April";
                break;
            case 5:
                monthNameToday = "May";
                break;
            case 6:
                monthNameToday = "June";
                break;
            case 7:
                monthNameToday = "July";
                break;
            case 8:
                monthNameToday = "August";
                break;
            case 9:
                monthNameToday = "September";
                break;
            case 10:
                monthNameToday = "October";
                break;
            case 11:
                monthNameToday = "November";
                break;
            case 12:
                monthNameToday = "December";
                break;
            default :
                monthNameToday = "Error";
                break;
    }
 }
<h2 class="text-secondary">@Model.Name</h2>
<h4>@days_num days old</h4>

<div class="pt-3"></div>
<div class="row">
    <div class="pl-2"></div>
    <div class="col-6-md">
        <div class"mr-4 pb-3">
            <a class="btn btn-secondary" asp-controller="Feed" asp-action="StartFeed" asp-route-id="@Model.BabyId" role="button">Start Feeding</a>
        </div>
    </div>
    <div class="col-6-md">
        <div class="pl-4 pb-3">
            <a class="btn btn-secondary text-white" asp-controller="Sleep" asp-action="StartSleep" asp-route-id="@Model.BabyId" role="button">Start Sleeping</a>
        </div>
    </div>
</div>

<div id="accordion">
    <div class="card bg-dark text-white">
        <div class="card-header" id="headingOne">
                <button class="btn btn-link btn-secondary collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    <h4>Sleeps @dateToday, @monthNameToday</h4>
                </button>
        </div>

        <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body text-white">
                @{
                    int sleepCount = 0;
                    double sleepDuration = 0;
                    string sleepStartTime = "0";
                    string sleepEndTime = "0";
                    int sleepView = 0;
                }
                <table class="table text-white">
                    <thead> 
                        <tr>
                            <th>
                                Sleep Count
                            </th>
                            <th>
                                Start Time
                            </th>
                            <th>
                                End Time
                            </th>
                            <th>
                                Duration
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (Sleep sleep in Model.Sleeps)
                        {    
                            sleepCount++;
                            sleepStartTime = sleep.StartTime.ToShortTimeString();
                            sleepEndTime = sleep.EndTime.ToShortTimeString();

                            

                            if (sleep.EndTime == DateTime.MinValue)
                            {
                                sleepDuration = 0;
                                sleepView = 1;
                            }
                            else
                            {   
                                sleepDuration = sleep.EndTime.Subtract(sleep.StartTime).TotalMinutes;
                                sleepView = 0;
                            }

                            if (sleepView == 0)
                            {
                           
                                <tr>
                                    <td>
                                        @sleepCount
                                    </td>
                                    <td>
                                        @sleepStartTime
                                    </td>
                                    <td>
                                        @sleepEndTime
                                    </td>
                                    <td>
                                        @sleepDuration
                                    </td>
                                </tr>
                            }

                        if (sleepView == 1)
                            {
                                <tr>
                                    <td>
                                        @sleepCount
                                    </td>
                                    <td>
                                        @sleepStartTime
                                    </td>
                                    <td>
                                        -
                                    </td>
                                    <td>
                                        @sleepDuration
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="card bg-dark text-white">
        <div class="card-header" id="headingTwo">
            <button class="btn btn-link collapsed  btn-secondary" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                <h4>Feeds @dateToday, @monthNameToday</h4>
            </button>
        </div>
        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
            <div class="card-body text-white">
                @{
                    int feedCount = 0;
                    double feedDuration = 0;
                    string feedStartTime = "0";
                    string feedEndTime = "0";
                    int feedView = 0;
                }

                <table class="table text-white">
                    <thead>
                        <tr>
                            <th>
                                Feed Count
                            </th>
                            <th>
                                Start Time
                            </th>
                            <th>
                                End Time
                            </th>
                            <th>
                                Duration
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (Feed feed in Model.Feeds)
                        {
                            
                            feedCount++;
                            feedStartTime = feed.StartTime.ToShortTimeString();
                            feedEndTime = feed.EndTime.ToShortTimeString();
                        
                            if (feed.EndTime == DateTime.MinValue)
                                {
                                    feedDuration = 0;
                                }
                            else
                               {
                                    feedDuration = feed.EndTime.Subtract(feed.StartTime).TotalMinutes;
                               }
                            
                        
                        if (feedView == 0)
                            {
                                <tr>
                                    <td>
                                        @feedCount
                                    </td>
                                    <td>
                                        @feedStartTime
                                    </td>
                                    <td>
                                        @feedEndTime
                                    </td>
                                    <td>
                                        @feedDuration
                                    </td>
                                </tr>
                            }

                            if (feedView == 1)
                            {
                                <tr>
                                    <td>
                                        @feedCount
                                    </td>
                                    <td>
                                        @feedStartTime
                                    </td>
                                    <td>
                                        -
                                    </td>
                                    <td>
                                        @feedDuration
                                    </td>
                                </tr>
                            }

                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


    



